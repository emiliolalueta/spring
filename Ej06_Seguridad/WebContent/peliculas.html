<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
</head>

<script>

xmlHttp = new XMLHttpRequest();

function buscarPelicula(id){
	xmlHttp.open("GET","servicio/peliculas/"+id,true);
	xmlHttp.onreadystatechange = function(){
		if( this.readyState == 4 ){
			//alert(this.responseText);
			rellenarFormulario(eval('['+this.responseText+']'));
		}		
	};
	xmlHttp.send(null);
}

function rellenarFormulario(pelicula){
	with(document.formulario){
		titulo.value   = pelicula[0].titulo;
		director.value = pelicula[0].director;
		genero.value   = pelicula[0].genero;
		year.value     = pelicula[0].year;		
	}
}

function listarPeliculas(){
	xmlHttp.open("GET","servicio/peliculas",true);
	xmlHttp.onreadystatechange = function(){
		if( this.readyState == 4 ){
			//alert(this.responseText);
			rellenarTabla(eval(this.responseText));
		}		
	};
	xmlHttp.send(null);
}

function rellenarTabla(peliculas){
	
	tabla = document.getElementById("tablaPeliculas");
	tabla.innerHTML = "";
	
	for(var a=0; a<peliculas.length; a++){
		
		p = peliculas[a];
		
		tr = document.createElement("tr");
		td1 = document.createElement("td");
		td2 = document.createElement("td");
		td3 = document.createElement("td");
		td4 = document.createElement("td");
		txt1 = document.createTextNode(p.titulo);
		txt2 = document.createTextNode(p.director);
		txt3 = document.createTextNode(p.genero);
		txt4 = document.createTextNode(p.year);
		td1.appendChild(txt1);
		td2.appendChild(txt2);
		td3.appendChild(txt3);
		td4.appendChild(txt4);
		tr.appendChild(td1);
		tr.appendChild(td2);
		tr.appendChild(td3);
		tr.appendChild(td4);
		
		//Para la selección:
		atr = document.createAttribute("id");
		atr.value = p.id;
		tr.setAttributeNode(atr);
		
		tr.onclick = function(){
			buscarPelicula(this.id);
		}
		
		tabla.appendChild(tr);		
	}
}

function insertar(){

	with(document.formulario){
		pelicula = { "id"       : id.value,
				     "titulo"   : titulo.value,
		             "director" : director.value,
			         "genero"   : genero.value,
			         "year"     : year.value}
	}
	
	xmlHttp.open("POST","servicio/peliculas",true);
	xmlHttp.onreadystatechange = function(){
		if( this.readyState == 4 ){
			listarPeliculas();
		}		
	};
	xmlHttp.setRequestHeader("Content-Type", 
			                 "application/json;charset=UTF-8")
	
	alert(JSON.stringify(pelicula)); 
	xmlHttp.send(JSON.stringify(pelicula));	
}

</script>

<body onload="listarPeliculas()">

	<h1 align="center">
		Películas
	</h1>
	
	<form name="formulario">
	
		<p align="center">
			<input type="button" value="Insertar"  onclick="insertar()"/>
			<input type="button" value="Modificar" onclick=""/>
			<input type="button" value="Borrar"    onclick=""/>
			<input type="button" value="Vaciar"    onclick=""/>
		</p>

		<input type="hidden" id="id" name="id"/>
	
		<table align="center">
			<tr>
				<td>Título</td>
				<td>
					<input type="text" id="titulo" name="titulo"/>
				</td>
			</tr>
			<tr>
				<td>Director</td>
				<td>
					<input type="text" id="director" name="director"/>
				</td>
			</tr>
			<tr>
				<td>Género</td>
				<td>
					<input type="text" id="genero" name="genero"/>
				</td>
			</tr>
			<tr>
				<td>Año</td>
				<td>
					<input type="text" id="year" name="year"/>
				</td>
			</tr>
		</table>

		<table align="center" width="500px" border="1">
			<tr>
				<th>Título</th>
				<th>Director</th>
				<th>Género</th>
				<th>Año</th>
			</tr>
			<tbody id="tablaPeliculas"></tbody>
		</table>
	
	</form>


</body>
</html>




